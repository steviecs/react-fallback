{"version":3,"file":"index.tsx","sources":["../src/useFallback.tsx","../src/index.tsx"],"sourcesContent":["import React, { useRef } from \"react\";\n\nconst tags = [\"P\", \"H1\", \"H2\", \"H3\", \"H4\", \"H5\", \"H6\", \"SPAN\", \"IMG\"];\n\nfunction assignFallbackAttributes(el: Element) {\n  let styles = \"\";\n  el.textContent = el.textContent || \"_\";\n  const css = window.getComputedStyle(el);\n\n  for (var i = 0; i < css.length; i++) {\n    styles += `background-color:rgba(0, 0, 0, 0.11);animation: skeleton 1s linear infinite alternate both;${\n      css[i]\n    }:${css.getPropertyValue(\"\" + css[i])};`;\n  }\n\n  return styles;\n}\n\ninterface UseFallbackProps {\n  isLoading: boolean;\n  fallbackOnStaticContent?: boolean;\n}\n\nexport default function useFallback({\n  isLoading,\n  fallbackOnStaticContent\n}: UseFallbackProps) {\n  const ref = useRef<HTMLDivElement>();\n\n  const withFallback = (tree: JSX.Element) => {\n    const Fallback = React.forwardRef((_, ref) =>\n      React.cloneElement(tree, { ref })\n    );\n\n    if (isLoading) {\n      return (\n        <Fallback\n          ref={(el: HTMLDivElement) => {\n            ref.current = el;\n            ref.current?.querySelectorAll(\"*\").forEach((el) => {\n              if (tags.includes(el.tagName) || el.firstChild?.nodeValue) {\n                const skeleton = document.createElement(\"div\");\n                if (fallbackOnStaticContent || !el.textContent) {\n                  skeleton.style.cssText = assignFallbackAttributes(el);\n                  el.replaceWith(skeleton);\n                }\n              }\n            });\n          }}\n        />\n      );\n    } else {\n      return tree;\n    }\n  };\n\n  return { withFallback };\n}\n","import useFallback from \"./useFallback\";\n\ninterface FallbackProps {\n  isLoading: boolean;\n  children: JSX.Element | JSX.Element[];\n  fallbackOnStaticContent?: boolean;\n}\n\nexport default function Fallback({\n  isLoading,\n  children,\n  fallbackOnStaticContent\n}: FallbackProps) {\n  const { withFallback } = useFallback({ isLoading, fallbackOnStaticContent });\n  return withFallback(<div>{children}</div>);\n}\n"],"names":["useRef","React","_jsx"],"mappings":"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"}